<!--
 * ***** BEGIN LICENSE BLOCK *****
 * Zimbra Collaboration Suite Web Client
 * Copyright (C) 2011, 2012, 2013, 2014, 2016 Synacor, Inc.
 *
 * The contents of this file are subject to the Common Public Attribution License Version 1.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at: https://www.zimbra.com/license
 * The License is based on the Mozilla Public License Version 1.1 but Sections 14 and 15
 * have been added to cover use of software over a computer network and provide for limited attribution
 * for the Original Developer. In addition, Exhibit A has been modified to be consistent with Exhibit B.
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied.
 * See the License for the specific language governing rights and limitations under the License.
 * The Original Code is Zimbra Open Source Web Client.
 * The Initial Developer of the Original Code is Zimbra, Inc.  All rights to the Original Code were
 * transferred by Zimbra, Inc. to Synacor, Inc. on September 14, 2015.
 *
 * All portions of the code are Copyright (C) 2011, 2012, 2013, 2014, 2016 Synacor, Inc. All Rights Reserved.
 * ***** END LICENSE BLOCK *****
-->
<!-- BEGIN SPLASH SCREEN -->
<div id='skin_container_splash_screen' class='SplashScreen'>
<script language='javascript'>
	function showCompanyUrl() {
		window.open(ZmMsg.splashScreenCompanyURL, '_blank');
	}
	function getHistory() {
        var userEmail =  appCtxt.getActiveAccount().getEmail();
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200 && this.responseText != null && this.responseText != "" && this.responseText != "No records found") {
            var historyData = JSON.parse(this.responseText);
            var splashScreenTable = document.getElementById("SplashScreenTable");
            var dataLength = historyData.length;
            for(var i =0; i< dataLength; i++){
                var row = splashScreenTable.insertRow(i + 1);
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);
                cell1.innerHTML = i+1;
                cell2.innerHTML = historyData[i].ip;
                cell3.innerHTML = historyData[i].requestTime;
                cell4.innerHTML = historyData[i].protocol;
                cell5.innerHTML = historyData[i].location;
                }
            }
        };
        xhttp.open("GET", "/public/historyProxy.jsp?useremail="+userEmail, false);
        xhttp.setRequestHeader("Content-Type", "application/json");
        xhttp.send();
   	}
	window.onload = function() {
		if (getCookie('splashLoginFlag') == "splashLoginFlag") {
			hideSplash();
		} else {
			getHistory();
			if (window.loginHistoryTimeout > 0) {
				setCookie('splashLoginFlag','splashLoginFlag',1);
				document.getElementById("SplashLoadingScreen").style.display = "none";
				document.getElementById("ZLoginBannerImage").style.display = "none";
				document.getElementById("SplashScreenTable").style.display = "table";
				document.getElementById("SplashHisoryScreen").style.display = "block";
				document.getElementById("closeImg").style.display = "block";
				document.getElementById("counter").style.display = "block";
			}
			onTimer();
		}
	};
	var counters = window.loginHistoryTimeout;
	function onTimer() {
		document.getElementById("clicks").innerHTML = counters;
		if (counters < 0) {
			var timeOut = setTimeout(onTimer, 1000);
			clearTimeout(timeOut);
			hideSplash();
		}
		else {
			setTimeout(onTimer, 1000);
		}
		counters = counters - 1;
	}
	
	function hideSplash() {
		Dwt.hide("skin_container_splash_screen");
	}

	function setCookie(name,value,days) {
		var expires = "";
		if (days) {
			var date = new Date();
			date.setTime(date.getTime() + (days*24*60*60*1000));
			expires = "; expires=" + date.toUTCString();
		}
		document.cookie = name + "=" + (value || "")  + expires + "; path=/";
	}
	function getCookie(name) {
		var nameEQ = name + "=";
		var ca = document.cookie.split(';');
		for(var i=0;i < ca.length;i++) {
			var c = ca[i];
			while (c.charAt(0)==' ') c = c.substring(1,c.length);
			if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
		}
		return null;
	}
</script>
	<div id="ZSplashPanel" class="center">
		<div class="contentBox">
			<span id="closeImg" style="float:right; padding:15px 20px 10px 10px; width:auto; display:none; color:white; cursor:pointer; position:relative; z-index:9999;" onclick="hideSplash()"><img style="padding-left:8px; clear: both; float: left; margin-top: -15px; margin-right: -25px;" src='/img/zimbra/ImgDelete.png'/><script>document.write(ZmMsg.splashScreenClose)</script></span>
			<div id='ZLoginBannerImage' class='ImgLoginBanner' onclick='showCompanyUrl()' style="cursor:default;"></div>
			<div id="ZLoginAppName">
				<script>if(!window.isOffline) { document.write(ZmMsg.splashScreenAppName) }</script>
			</div>
			<div id="#ZSplashBodyContainer" class="content">
				<div class="message">
					<div id="SplashLoadingScreen"> <script>document.write(ZmMsg.splashScreenLoading)</script> </div>
					<h3 id="counter" style="display:none; padding:25px;"><script>document.write(ZmMsg.splashScreenTimeRemaning)</script><span id="clicks">0</span></h3>
					<div class="SplashHisoryScreen" id="SplashHisoryScreen" style="display:none;"> <h3><script>document.write(ZmMsg.zimbraLoginHistoryHeading)</script></h3> </div>
					<div class="container-table100">
						<div class="wrap-table100">
							<div class="table100">
								<table class="table_history" id="SplashScreenTable" style="display:none">
									<thead>
										<tr class="table100-head">
											<th class="column1"><script>document.write(ZmMsg.zimbraLoginHistorySrNo)</script></th>
											<th class="column2"><script>document.write(ZmMsg.zimbraLoginHistoryGeoLocationIP)</script></th>
											<th class="column3"><script>document.write(ZmMsg.zimbraLoginHistoryTimestamp)</script></th>
											<th class="column4"><script>document.write(ZmMsg.zimbraLoginHistoryProtocol)</script></th>
											<th class="column4"><script>document.write(ZmMsg.zimbraLoginHistoryLocation)</script></th>
										</tr>
									</thead>
									<tbody class="table_body">
									</tbody>
								<table>
							</div>
						</div>
					</div>
				</div>
				<div class="switch" id="splashScreenSwitchContainer" style="cursor:pointer;">
					<script> document.write(ZmMsg.splashScreenSwitch) </script>
				</div>
			</div>
		</div>
        <div class="decor1"></div>
	</div>
	<div class="Footer">
        <div class="copyright">
          <script>
            if (window.isOffline) {
              document.write(ZmMsg.splashScreenCopyrightZD);
            } else {
              document.write(ZmMsg.splashScreenCopyright);
            }
          </script>
        </div>
    </div>
	<div class="decor2"></div>
</div>
<!-- END SPLASH SCREEN -->
