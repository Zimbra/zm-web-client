<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="app" uri="com.zimbra.htmlclient" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="com.zimbra.i18n" %>
<app:handleError>
    <zm:getMailbox var="mailbox"/>
    <app:skin mailbox="${mailbox}"/>
    <c:choose>
    <c:when test="${not empty mailbox.prefs.locale}">
        <fmt:setLocale value='${mailbox.prefs.locale}' scope='request' />
    </c:when>
    <c:otherwise>
        <fmt:setLocale value='${pageContext.request.locale}' scope='request' />
    </c:otherwise>
    </c:choose>
    <fmt:setBundle basename="/messages/ZhMsg" scope="request"/>
    
    <zm:computeSearchContext var="context" usecache="true"/>
    <c:set var="useTo" value="${context.folder.isPlacedCalls}"/>
</app:handleError>

<html>
<app:head mailbox="${mailbox}"/>

<body style='background:white;'>
    <div class='ZhCallListPrintView'>
        <table><tr>
            <td class='ZhZimbraTitle'><fmt:message key="zimbraTitle"/></td>
            <td nowrap width='1%'><b>${fn:escapeXml(mailbox.name)}</b></td>
        </tr></table>
        <hr/>

        <h1>${zm:getVoiceFolderName(pageContext, context.folder)}</h1>
        <table class='ZhCallListPrintTable' cellpadding=2 cellspacing=0 width="80%">
            <tr class='Header'>
                <th width="30%"><fmt:message key="${useTo ? 'to' : 'from'}"/>
                <th width="30%"><fmt:message key="duration"/></th>
                <th width="20%"><fmt:message key="received"/></th>
            </tr>

            <c:forEach items="${context.searchResult.hits}" var="hit" varStatus="status">
            <tr>
                <td nowrap>${zm:getDisplayCaller(pageContext, useTo ? hit.callHit.recipient : hit.callHit.caller)}</td>
                <td nowrap>${fn:escapeXml(zm:displayDuration(pageContext, hit.callHit.duration))}</td>
                <td nowrap>${fn:escapeXml(zm:displayVoiceDate(pageContext, hit.callHit.date))}</td>
            </tr>
            </c:forEach>
        </table>
        <c:if test="${context.searchResult.size == 0}">
            <div class='NoResults'><fmt:message key="noResultsFound"/></div>
        </c:if>
    </div>
    <script type="text/javascript">
        <!--
        window.print();
        // -->
    </script>
</body>
</html>
