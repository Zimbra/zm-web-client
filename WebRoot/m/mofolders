<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="mo" uri="com.zimbra.mobileclient" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="com.zimbra.i18n" %>
<mo:handleError>
    <zm:getMailbox var="mailbox"/>
    <c:choose>
        <c:when test="${not empty mailbox.prefs.locale}">
            <fmt:setLocale value='${mailbox.prefs.locale}' scope='request'/>
        </c:when>
        <c:otherwise>
            <fmt:setLocale value='${pageContext.request.locale}' scope='request'/>
        </c:otherwise>
    </c:choose>
    <fmt:setBundle basename="/messages/ZhMsg" scope="request"/>

    <fmt:message var="title" key="MO_mailFoldersTags"/>
</mo:handleError>
<c:set var="context_url" value="${requestScope.baseURL!=null?requestScope.baseURL:'zmain'}"/>
<c:set value="${title}" var="title" scope="request"/>
<%--
<div class="Toolbar table">
    <div class="table-row">
        <div class="table-cell">
            <span class="Title left">
                    <fmt:message key="briefcases"/>
                </span>
                 --%>
<%--<span class="right">
                    <a class="zo_button" href="?st=folders${empty param.showFolderCreate?'&showFolderCreate=1':''}#folders" onclick="return showHideElemForm('nfldrfrm');"><fmt:message key="create"/></a>
                </span>--%>
<%--
        </div>
    </div>
</div>
<c:if test="${not empty param.sfi}">
    <zm:computeSearchContext  types="document" query="sfi=${param.sfi}" var="context" limit="${sessionScope.limit}"/>
    <!-- Hit Count: ${context.searchResult.size} -->
    <c:forEach items="${context.searchResult.hits}" var="hit" varStatus="status">
        doc: ${hit.briefcaseHit.document.name}
    </c:forEach>
</c:if>
<zm:forEachFolder var="folder">
    <c:if test="${folder.isDocumentView}">
        <mo:overviewFolder folder="${folder}" base="${context_url}?st=folders"/>    
    </c:if>
</zm:forEachFolder>
--%>

<div class="Toolbar table">
    <div class="table-row">
        <div class="table-cell">
            <span class="Title left">
                    <fmt:message key="folders"/>
                </span>
                 <span class="right">
                    <a class="zo_button1" href="?st=folders${empty param.showFolderCreate?'&showFolderCreate=1':''}#folders" onclick="return showHideElemForm('nfldrfrm');"><fmt:message key="create"/></a>
                </span>
        </div>
    </div>
</div>
<div class="table View" id="nfldrfrm" style="${empty param.showFolderCreate?'display:none':''};">
    <div class="table-row">
        <div class="table-cell">
            <form action="" method="post" style="padding:0px;margin:0px;">
                <input type="hidden" name="doFolderAction" value="1">
                <input name="crumb" type="hidden" value="${fn:escapeXml(mailbox.accountInfo.crumb)}"/>
                <span class="label"><fmt:message key="name"/>:</span> <input type="text" name="folder_name"
                                                                             style="width:100px;"  class="Textarea">
                <input class="zo_button" type="submit" name="actionSaveFolder" value="<fmt:message key='save'/>">
                <br/>
                <select name="parentid" style="width:100px;">
                <option value="${mailbox.inbox.parentId}">--<fmt:message key="in"/>--</option>
                <zm:forEachFolder parentid="${mailbox.inbox.id}" var="fldr" skiproot="false">
                    <c:if test="${fldr.isConversationView || fldr.isMailView}">
                        <option value="${fldr.id}">${fn:escapeXml(fldr.rootRelativePath)}</option>
                    </c:if>
                </zm:forEachFolder>
                <zm:forEachFolder parentid="${mailbox.sent.id}" var="fldr" skiproot="false">
                    <c:if test="${fldr.isConversationView || fldr.isMailView}">
                        <option value="${fldr.id}">${fn:escapeXml(fldr.rootRelativePath)}</option>
                    </c:if>
                </zm:forEachFolder>
                <zm:forEachFolder parentid="${mailbox.drafts.id}" var="fldr" skiproot="false">
                    <c:if test="${fldr.isConversationView || fldr.isMailView}">
                        <option value="${fldr.id}">${fn:escapeXml(fldr.rootRelativePath)}</option>
                    </c:if>
                </zm:forEachFolder>
                <zm:forEachFolder var="fldr" skiproot="${true}" skipsystem="${true}" skiptopsearch="${true}">
                    <c:if test="${fldr.isConversationView || fldr.isMailView}">
                        <option value="${fldr.id}">${fn:escapeXml(fldr.rootRelativePath)}</option>
                    </c:if>
                </zm:forEachFolder>
            </select>
            </form>
        </div>
        <a name="folders" style="padding:0px;margin:0px;"></a>
    </div>
</div>

<c:if test="${empty param.sq || fn:containsIgnoreCase(mailbox.inbox.name,param.sq)}">
    <mo:overviewFolder base="${context_url}" folder="${mailbox.inbox}"/>
    <mo:doFolderTree skiproot="${true}" parentid="${mailbox.inbox.id}" skipsystem="false"/>
</c:if>
<c:if test="${empty param.sq ||fn:containsIgnoreCase(mailbox.sent.name,param.sq)}">
    <mo:overviewFolder base="${context_url}" folder="${mailbox.sent}"/>
    <mo:doFolderTree skiproot="${true}" parentid="${mailbox.sent.id}" skipsystem="false"/>
</c:if>
<c:if test="${empty param.sq ||fn:containsIgnoreCase(mailbox.drafts.name,param.sq)}">
    <mo:overviewFolder base="${context_url}" folder="${mailbox.drafts}"/>
    <mo:doFolderTree skiproot="${true}" parentid="${mailbox.drafts.id}" skipsystem="false"/>
</c:if>
<c:if test="${empty param.sq ||fn:containsIgnoreCase(mailbox.spam.name,param.sq)}">
    <mo:overviewFolder base="${context_url}" folder="${mailbox.spam}"/>
    <mo:doFolderTree skiproot="${true}" parentid="${mailbox.spam.id}" skipsystem="false"/>
</c:if>
<c:if test="${empty param.sq ||fn:containsIgnoreCase(mailbox.trash.name,param.sq)}">
    <mo:overviewFolder base="${context_url}" folder="${mailbox.trash}"/>
    <mo:doFolderTree skiproot="${true}" parentid="${mailbox.trash.id}" skipsystem="false"/>
</c:if>
<mo:doFolderTree skiproot="${true}" skipsystem="${true}" skiptopsearch="${true}"/>

<div class="Toolbar table">
    <div class="table-row">
        <div class="table-cell">
            <span class="Title left">
                <fmt:message key="searches"/></span>
        </div>
    </div>
</div>

<zm:forEachFolder var="folder" skipsystem="${true}" skiptopsearch="${false}">
    <c:if test="${(folder.isSearchFolder && (empty param.sq || fn:containsIgnoreCase(folder.name,param.sq)))}">
        <mo:overviewSearchFolder folder="${folder}"/>
    </c:if>
</zm:forEachFolder>
<div class="Toolbar table">
<div class="table-row">
    <div class="table-cell">
            <span class="Title left">
                        <fmt:message key="tags"/>
            </span>
            <c:if test="${mailbox.features.tagging}"><span class="right">
                <a class="zo_button1" href="?st=folders${empty param.showTagCreate?'&showTagCreate=1':''}#tags" onclick="return showHideElemForm('ntagfrm');"><fmt:message
                                key="create"/></a>
            </span></c:if>
    </div>
</div>
</div>
<c:if test="${mailbox.features.tagging}">
<div class="table View" id="ntagfrm" style="${empty param.showTagCreate?'display:none':''};">
    <div class="table-row">
        <div class="table-cell">
            <form action="" method="post" style="padding:0px;margin:0px;">
                <input type="hidden" name="doFolderAction" value="1">
                <input name="crumb" type="hidden" value="${fn:escapeXml(mailbox.accountInfo.crumb)}"/>
                <span class="label"><fmt:message key="name"/>:</span> <input type="text" style="width:100px;"  class="Textarea" name="tag_name">
                <input type="submit" class="zo_button" name="actionSaveTag" value="<fmt:message key='save'/>">
                <br/>
                <select name="tag_color">
                    <optgroup label="<fmt:message key='color'/>">
                        <option value="cyan"><fmt:message key="cyan"/></option>
                        <option value="blue"><fmt:message key="blue"/></option>
                        <option value="purple"><fmt:message key="purple"/></option>
                        <option value="red"><fmt:message key="red"/></option>
                        <option value="orange"><fmt:message key="orange"/></option>
                        <option value="yellow"><fmt:message key="yellow"/></option>
                        <option value="green"><fmt:message key="green"/></option>
                    </optgroup>
                </select>
            </form>
        </div>
        <a name="tags" style="padding:0px;margin:0px;"></a>
    </div>
</div>
</c:if>
<zm:forEachTag var="tag">
    <c:if test="${empty param.sq || fn:containsIgnoreCase(tag.name, param.sq)}">
        <mo:overviewTag calendars="${false}" tag="${tag}" skiptypes="${true}"/>
    </c:if>
</zm:forEachTag>
<script type="text/javascript">
    var showHideElemForm = function(elemId) {
        var elem = document.getElementById(elemId)
        if (!elem) return;
        if (elem.style.display == 'none') {
            elem.style.display = '';
        } else {
            elem.style.display = 'none';
        }
        return false;
    }
</script>
 
